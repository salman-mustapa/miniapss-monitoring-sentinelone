<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>SentinelOne Monitor - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0e0f;
      --bg-secondary: #0f1419;
      --bg-tertiary: #1a1f24;
      --accent-green: #00ff41;
      --accent-cyan: #00ffff;
      --text-primary: #00ff41;
      --text-secondary: #8aff9b;
      --border-color: #0f4;
    }
    
    body { 
      background: var(--bg-primary); 
      color: var(--text-primary); 
      font-family: "Courier New", monospace; 
      margin: 0;
      overflow-x: hidden;
    }
    
    .hacker-header {
      background: linear-gradient(90deg, var(--bg-secondary), var(--bg-tertiary));
      border-bottom: 2px solid var(--accent-green);
      padding: 15px 20px;
      box-shadow: 0 2px 10px rgba(0, 255, 65, 0.3);
    }
    
    .hacker-title {
      color: var(--accent-green);
      font-size: 1.8rem;
      font-weight: bold;
      text-shadow: 0 0 10px var(--accent-green);
      margin: 0;
    }
    
    .nav-tabs {
      border-bottom: 2px solid var(--accent-green);
      background: var(--bg-secondary);
      margin: 0;
    }
    
    .nav-tabs .nav-link {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-family: "Courier New", monospace;
      font-weight: bold;
      padding: 15px 25px;
      margin-right: 2px;
      transition: all 0.3s ease;
    }
    
    .nav-tabs .nav-link:hover {
      color: var(--accent-green);
      background: rgba(0, 255, 65, 0.1);
      text-shadow: 0 0 5px var(--accent-green);
    }
    
    .nav-tabs .nav-link.active {
      background: var(--accent-green);
      color: var(--bg-primary);
      border-bottom: 3px solid var(--accent-cyan);
      text-shadow: none;
    }
    
    .tab-content {
      background: var(--bg-primary);
      min-height: calc(100vh - 140px);
      padding: 20px;
    }
    
    .hacker-card {
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0, 255, 65, 0.2);
      transition: all 0.3s ease;
    }
    
    .hacker-card:hover {
      box-shadow: 0 6px 20px rgba(0, 255, 65, 0.4);
      transform: translateY(-2px);
    }
    
    .form-control, .form-select {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      font-family: "Courier New", monospace;
    }
    
    .form-control:focus, .form-select:focus {
      background: var(--bg-secondary);
      border-color: var(--accent-green);
      color: var(--text-primary);
      box-shadow: 0 0 0 0.2rem rgba(0, 255, 65, 0.25);
    }
    
    .btn-hacker {
      background: linear-gradient(45deg, var(--accent-green), var(--accent-cyan));
      border: none;
      color: var(--bg-primary);
      font-family: "Courier New", monospace;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 4px;
      transition: all 0.3s ease;
    }
    
    .btn-hacker:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(0, 255, 65, 0.5);
      color: var(--bg-primary);
    }
    
    .terminal-output {
      background: #000;
      color: var(--accent-green);
      font-family: "Courier New", monospace;
      padding: 15px;
      border-radius: 8px;
      height: 300px;
      overflow-y: auto;
      border: 1px solid var(--accent-green);
      white-space: pre-wrap;
      box-shadow: inset 0 0 10px rgba(0, 255, 65, 0.3);
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-online { background: var(--accent-green); box-shadow: 0 0 5px var(--accent-green); }
    .status-offline { background: #ff4444; box-shadow: 0 0 5px #ff4444; }
    .status-warning { background: #ffaa00; box-shadow: 0 0 5px #ffaa00; }
    
    .logout-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      background: #ff4444;
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-family: "Courier New", monospace;
      transition: all 0.3s ease;
    }
    
    .logout-btn:hover {
      background: #ff6666;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div class="hacker-header position-relative">
    <h1 class="hacker-title">
      <i class="fas fa-shield-alt"></i> SENTINELONE MONITOR v2.0
      <span style="font-size: 0.6em; color: var(--accent-cyan);">[SECURE]</span>
    </h1>
    <button class="logout-btn" onclick="logout()">
      <i class="fas fa-sign-out-alt"></i> LOGOUT
    </button>
  </div>

  <ul class="nav nav-tabs" id="mainTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
        <i class="fas fa-tachometer-alt"></i> DASHBOARD
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="sentinelone-tab" data-bs-toggle="tab" data-bs-target="#sentinelone" type="button" role="tab">
        <i class="fas fa-shield-virus"></i> SENTINELONE
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button" role="tab">
        <i class="fas fa-bell"></i> NOTIFICATIONS
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="whatsapp-tab" data-bs-toggle="tab" data-bs-target="#whatsapp" type="button" role="tab">
        <i class="fab fa-whatsapp"></i> WHATSAPP
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="config-tab" data-bs-toggle="tab" data-bs-target="#config" type="button" role="tab">
        <i class="fas fa-cogs"></i> CONFIG
      </button>
    </li>
  </ul>

  <div class="tab-content" id="mainTabContent">
    <!-- Dashboard Tab -->
    <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="hacker-card">
            <h5><i class="fas fa-server"></i> SYSTEM STATUS</h5>
            <div class="mt-3">
              <div class="mb-2">
                <span class="status-indicator status-online"></span>
                <strong>POLLING:</strong> <span id="polling-status">ACTIVE</span>
              </div>
              <div class="mb-2">
                <span class="status-indicator status-online"></span>
                <strong>BACKUP:</strong> <span id="backup-status">ACTIVE</span>
              </div>
              <div class="mb-2">
                <span class="status-indicator status-online"></span>
                <strong>WEB:</strong> <span id="web-status">ONLINE</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="hacker-card">
            <h5><i class="fas fa-chart-line"></i> STATISTICS</h5>
            <div class="mt-3">
              <div class="mb-2"><strong>THREATS DETECTED:</strong> <span id="threats-count">0</span></div>
              <div class="mb-2"><strong>ALERTS SENT:</strong> <span id="alerts-count">0</span></div>
              <div class="mb-2"><strong>UPTIME:</strong> <span id="uptime">00:00:00</span></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="hacker-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5><i class="fas fa-terminal"></i> PROCESS OUTPUT</h5>
          <div>
            <button class="btn btn-hacker btn-sm" onclick="clearTerminal()">
              <i class="fas fa-trash"></i> CLEAR
            </button>
            <button class="btn btn-hacker btn-sm" onclick="toggleAutoScroll()">
              <i class="fas fa-arrow-down"></i> AUTO-SCROLL: <span id="autoScrollStatus">ON</span>
            </button>
          </div>
        </div>
        <div id="terminal-output" class="terminal-output"></div>
      </div>
    </div>

    <!-- SentinelOne Tab -->
    <div class="tab-pane fade" id="sentinelone" role="tabpanel">
      <div class="hacker-card">
        <h5><i class="fas fa-shield-virus"></i> SENTINELONE CONFIGURATION</h5>
        <form id="sentinelone-form">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">API BASE URL</label>
              <input type="url" class="form-control" id="sentinel-url" placeholder="https://your-sentinel-instance.com">
            </div>
            <div class="col-md-6">
              <label class="form-label">API TOKEN</label>
              <input type="password" class="form-control" id="sentinel-token" placeholder="Your API Token">
            </div>
            <div class="col-md-6">
              <label class="form-label">POLLING INTERVAL (seconds)</label>
              <input type="number" class="form-control" id="polling-interval" value="60" min="10">
            </div>
            <div class="col-md-6">
              <label class="form-label">CONNECTION STATUS</label>
              <div class="d-flex align-items-center">
                <span class="status-indicator status-offline" id="sentinel-status"></span>
                <button type="button" class="btn btn-hacker btn-sm" onclick="testSentinelConnection()">
                  TEST CONNECTION
                </button>
              </div>
            </div>
          </div>
          <div class="mt-3">
            <button type="submit" class="btn btn-hacker">
              <i class="fas fa-save"></i> SAVE CONFIGURATION
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Notifications Tab -->
    <div class="tab-pane fade" id="notifications" role="tabpanel">
      <div class="row g-3">
        <div class="col-md-4">
          <div class="hacker-card">
            <h6><i class="fab fa-telegram"></i> TELEGRAM</h6>
            <form id="telegram-form">
              <div class="mb-3">
                <label class="form-label">BOT TOKEN</label>
                <input type="password" class="form-control" id="telegram-token">
              </div>
              <div class="mb-3">
                <label class="form-label">CHAT ID</label>
                <input type="text" class="form-control" id="telegram-chat">
              </div>
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="telegram-enabled">
                <label class="form-check-label">ENABLED</label>
              </div>
              <button type="submit" class="btn btn-hacker btn-sm">SAVE</button>
            </form>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="hacker-card">
            <h6><i class="fab fa-microsoft"></i> TEAMS</h6>
            <form id="teams-form">
              <div class="mb-3">
                <label class="form-label">WEBHOOK URL</label>
                <input type="url" class="form-control" id="teams-webhook">
              </div>
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="teams-enabled">
                <label class="form-check-label">ENABLED</label>
              </div>
              <button type="submit" class="btn btn-hacker btn-sm">SAVE</button>
            </form>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="hacker-card">
            <h6><i class="fab fa-whatsapp"></i> WHATSAPP</h6>
            <div class="mb-3">
              <label class="form-label">GATEWAY STATUS</label>
              <div class="d-flex align-items-center">
                <span class="status-indicator status-offline" id="wa-gateway-status"></span>
                <span id="wa-gateway-text">DISCONNECTED</span>
              </div>
            </div>
            <button type="button" class="btn btn-hacker btn-sm" onclick="switchToWhatsAppTab()">
              CONFIGURE
            </button>
          </div>
        </div>
      </div>
      
      <div class="hacker-card">
        <h5><i class="fas fa-paper-plane"></i> TEST NOTIFICATIONS</h5>
        <button class="btn btn-hacker" onclick="testAllNotifications()">
          <i class="fas fa-rocket"></i> SEND TEST MESSAGE
        </button>
      </div>
    </div>

    <!-- WhatsApp Tab -->
    <div class="tab-pane fade" id="whatsapp" role="tabpanel">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="hacker-card">
            <h5><i class="fas fa-cog"></i> GATEWAY CONFIG</h5>
            <form id="wa-config-form">
              <div class="mb-3">
                <label class="form-label">GATEWAY URL</label>
                <input type="url" class="form-control" id="wa-base-url" value="http://localhost:5013">
              </div>
              <div class="mb-3">
                <label class="form-label">DEFAULT SESSION</label>
                <input type="text" class="form-control" id="wa-session" value="gateway">
              </div>
              <button type="submit" class="btn btn-hacker">SAVE CONFIG</button>
            </form>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="hacker-card">
            <h5><i class="fas fa-qrcode"></i> QR CODE</h5>
            <div id="qr-container" class="text-center">
              <button class="btn btn-hacker" onclick="generateQR()">
                <i class="fas fa-qrcode"></i> GENERATE QR
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="hacker-card">
        <h5><i class="fas fa-users"></i> SESSIONS</h5>
        <div id="sessions-container">
          <div class="text-center">
            <button class="btn btn-hacker" onclick="refreshSessions()">
              <i class="fas fa-sync"></i> REFRESH SESSIONS
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Config Tab -->
    <div class="tab-pane fade" id="config" role="tabpanel">
      <div class="hacker-card">
        <h5><i class="fas fa-shield-alt"></i> SECURITY</h5>
        <form id="security-form">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">WEB PIN</label>
              <input type="password" class="form-control" id="web-pin">
            </div>
            <div class="col-md-6">
              <label class="form-label">SESSION TIMEOUT (minutes)</label>
              <input type="number" class="form-control" id="session-timeout" value="60">
            </div>
          </div>
          <div class="mt-3">
            <button type="submit" class="btn btn-hacker">SAVE SECURITY</button>
          </div>
        </form>
      </div>
      
      <div class="hacker-card">
        <h5><i class="fas fa-database"></i> BACKUP SETTINGS</h5>
        <form id="backup-form">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">BACKUP FREQUENCY</label>
              <select class="form-select" id="backup-frequency">
                <option value="hourly">HOURLY</option>
                <option value="daily" selected>DAILY</option>
                <option value="weekly">WEEKLY</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">RETENTION DAYS</label>
              <input type="number" class="form-control" id="retention-days" value="30">
            </div>
          </div>
          <div class="mt-3">
            <button type="submit" class="btn btn-hacker">SAVE BACKUP</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let autoScroll = true;
    let terminalContent = '';

    function logout() {
      window.location.href = '/logout';
    }

    function switchToWhatsAppTab() {
      const tab = new bootstrap.Tab(document.getElementById('whatsapp-tab'));
      tab.show();
    }

    function clearTerminal() {
      terminalContent = '';
      document.getElementById('terminal-output').textContent = '';
    }

    function toggleAutoScroll() {
      autoScroll = !autoScroll;
      document.getElementById('autoScrollStatus').textContent = autoScroll ? 'ON' : 'OFF';
    }

    function appendToTerminal(message) {
      terminalContent += message + '\n';
      const terminal = document.getElementById('terminal-output');
      terminal.textContent = terminalContent;
      
      if (autoScroll) {
        terminal.scrollTop = terminal.scrollHeight;
      }
    }

    async function testSentinelConnection() {
      const button = event.target;
      const originalText = button.innerHTML;
      button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> TESTING...';
      button.disabled = true;
      
      try {
        const response = await fetch('/api/test-connection', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ type: 'sentinel' })
        });
        
        const data = await response.json();
        const statusIndicator = document.getElementById('sentinel-status');
        
        if (data.success) {
          statusIndicator.className = 'status-indicator status-online';
          appendToTerminal('[SUCCESS] SentinelOne connection established');
        } else {
          statusIndicator.className = 'status-indicator status-offline';
          appendToTerminal('[ERROR] SentinelOne connection failed: ' + data.error);
        }
      } catch (error) {
        appendToTerminal('[ERROR] Connection test failed: ' + error.message);
      } finally {
        button.innerHTML = originalText;
        button.disabled = false;
      }
    }

    async function testAllNotifications() {
      const button = event.target;
      const originalText = button.innerHTML;
      button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> TESTING...';
      button.disabled = true;
      
      try {
        const response = await fetch('/api/test-notifications', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const data = await response.json();
        
        if (data.success) {
          appendToTerminal('[SUCCESS] Notification test completed');
          if (data.results.success.length > 0) {
            data.results.success.forEach(msg => appendToTerminal('[OK] ' + msg));
          }
          if (data.results.errors.length > 0) {
            data.results.errors.forEach(msg => appendToTerminal('[FAIL] ' + msg));
          }
        } else {
          appendToTerminal('[ERROR] Notification test failed: ' + data.error);
        }
      } catch (error) {
        appendToTerminal('[ERROR] Test failed: ' + error.message);
      } finally {
        button.innerHTML = originalText;
        button.disabled = false;
      }
    }

    async function generateQR() {
      const session = document.getElementById('wa-session').value || 'gateway';
      const container = document.getElementById('qr-container');
      
      container.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> GENERATING...</div>';
      
      try {
        const response = await fetch(`/api/wa/qr?session=${session}`);
        const data = await response.json();
        
        if (data.success && data.qr) {
          container.innerHTML = `<img src="${data.qr}" alt="QR Code" class="img-fluid" style="max-width: 300px;">`;
          appendToTerminal('[SUCCESS] QR code generated for session: ' + session);
        } else {
          container.innerHTML = '<div class="text-danger">QR generation failed</div>';
          appendToTerminal('[ERROR] QR generation failed: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        container.innerHTML = '<div class="text-danger">Connection error</div>';
        appendToTerminal('[ERROR] QR request failed: ' + error.message);
      }
    }

    async function refreshSessions() {
      const container = document.getElementById('sessions-container');
      container.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> LOADING...</div>';
      
      try {
        const response = await fetch('/api/wa/sessions');
        const data = await response.json();
        
        if (data.success && data.sessions) {
          let html = '<div class="row g-2">';
          data.sessions.forEach(session => {
            const statusClass = session.status === 'connected' ? 'status-online' : 'status-offline';
            html += `
              <div class="col-md-6">
                <div class="hacker-card">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <span class="status-indicator ${statusClass}"></span>
                      <strong>${session.name || session.session}</strong>
                    </div>
                    <div>
                      <button class="btn btn-hacker btn-sm" onclick="connectSession('${session.name || session.session}')">
                        CONNECT
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            `;
          });
          html += '</div>';
          container.innerHTML = html;
        } else {
          container.innerHTML = '<div class="text-center text-warning">No sessions found</div>';
        }
      } catch (error) {
        container.innerHTML = '<div class="text-center text-danger">Failed to load sessions</div>';
        appendToTerminal('[ERROR] Session refresh failed: ' + error.message);
      }
    }

    async function connectSession(sessionName) {
      try {
        const response = await fetch('/api/wa/connect', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `session=${sessionName}`
        });
        
        const data = await response.json();
        
        if (data.success) {
          appendToTerminal('[SUCCESS] Session connected: ' + sessionName);
          refreshSessions();
        } else {
          appendToTerminal('[ERROR] Session connection failed: ' + data.error);
        }
      } catch (error) {
        appendToTerminal('[ERROR] Connection request failed: ' + error.message);
      }
    }

    // Form submissions
    document.getElementById('sentinelone-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      // Handle SentinelOne config save
      appendToTerminal('[INFO] Saving SentinelOne configuration...');
    });

    document.getElementById('telegram-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      // Handle Telegram config save
      appendToTerminal('[INFO] Saving Telegram configuration...');
    });

    document.getElementById('teams-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      // Handle Teams config save
      appendToTerminal('[INFO] Saving Teams configuration...');
    });

    document.getElementById('wa-config-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      // Handle WhatsApp config save
      appendToTerminal('[INFO] Saving WhatsApp configuration...');
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      appendToTerminal('[SYSTEM] SentinelOne Monitor v2.0 initialized');
      appendToTerminal('[SYSTEM] All systems operational');
      
      // Start periodic updates
      setInterval(() => {
        // Update system status periodically
      }, 5000);
    });
  </script>
</body>
</html>
